<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN-5000: Project – cleaning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../introduction/introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-mattycars" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-mattycars/tree/main/data" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gathering/gathering.html" rel="" target="">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-cleaning" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Data Cleaning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-cleaning">    
        <li>
    <a class="dropdown-item" href="../cleaning/cleaning.html" rel="" target="">
 <span class="dropdown-text">Data Cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cleaning/text.html" rel="" target="">
 <span class="dropdown-text">Text Data Cleaning</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../eda/eda.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-naive-bayes-classification" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Naive Bayes Classification</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-naive-bayes-classification">    
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NaiveBayesIntro.html" rel="" target="">
 <span class="dropdown-text">Introduction to Naive Bayes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NB_categorical_classifier.html" rel="" target="">
 <span class="dropdown-text">Classification of Podium Finishing at HKJC (probably re work this section with a cateogorical classifier and then multinomial classifier with rating and draw)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NB_text_classifier.html" rel="" target="">
 <span class="dropdown-text">Text Classification for Tweet Sentiment Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../dimensionality/dimensionality.html" rel="" target="">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../clustering/clustering.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../ARM/ARM.html" rel="" target="">
 <span class="menu-text">ARM</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-decision-trees" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Decision Trees</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-decision-trees">    
        <li>
    <a class="dropdown-item" href="../trees/classification.html" rel="" target="">
 <span class="dropdown-text">Classification Trees</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../trees/regression.html" rel="" target="">
 <span class="dropdown-text">Regression</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../conclusions/conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link active" data-scroll-target="#data-cleaning">Data Cleaning</a>
  <ul class="collapse">
  <li><a href="#lets-start-by-cleaning-horses" id="toc-lets-start-by-cleaning-horses" class="nav-link" data-scroll-target="#lets-start-by-cleaning-horses">Let’s start by cleaning horses:</a></li>
  <li><a href="#now-lets-clean-performances" id="toc-now-lets-clean-performances" class="nav-link" data-scroll-target="#now-lets-clean-performances">Now let’s clean Performances</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="data-cleaning" class="level1">
<h1>Data Cleaning</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>horses<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../../../data/00-raw-data/horses.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>performances<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"../../../data/00-raw-data/performances.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lets-start-by-cleaning-horses" class="level2">
<h2 class="anchored" data-anchor-id="lets-start-by-cleaning-horses">Let’s start by cleaning horses:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(horses,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id       horse_name horse_name_zh
1     L247     REAL SUPREME      天外之天
2    44170 LIM'S INVINCIBLE      林家无敌
                                                                         horse_url
1 http://racing.hkjc.com/racing/info/horse/GetFilteredHorseFormRecord/english/L247
2          http://www.turfclub.com.sg/Racing/Pages/HorseProfile.aspx?HorseID=44170
  horse_country is_active country age             trainer_id   colour     sex
1            HK      TRUE     AUS   9                    CCW Chestnut Gelding
2            SG      TRUE     AUS   3 STEVEN HAROLD BURRIDGE                 
                 owner_name
1 Lai Ni Jan | Benvinda Lai
2              LIM'S STABLE
                                            owner_link import_type
1 ownersearch.asp?horseowner=Lai Ni Jan | Benvinda Lai         ISG
2                                                                 
  current_rating season_stake start_of_season_rating total_stake
1             34        37800                     39     6607700
2             50           NA                     NA       38182
                   sire
1           Flying Spur
2 I AM INVINCIBLE (AUS)
                                                                           same_sire_url
1 http://racing.hkjc.com/racing/info/Horse/SameSire/english/Rmx5aW5nIFNwdXIgICAgICAgICA=
2                                                                                       
  no_of_1_2_3                 dam no_of_start_past_10_meetings dam_sire
1    8-5-6-75           Irgunette                            1    Irgun
2             REIGNING CASH (AUS)                           NA         
                         same_sire last_updated
1 ["T387", "M273", "T280", "V334"]      08:18.0
2                                       11:32.8</code></pre>
</div>
</div>
<p>We are going to remove “horse_name_zh” which contains the horses’ names in Cantonese, “horse_url”, “owner_url”, “sire”, “no_of_start_past_10_meetings”, “dam”,“dam_sire”, “same_sire and”last_updated”. <em>Note for grader: I will go into more depth why I am removing these in the future</em> completion of this project.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="ot">&lt;-</span>horses[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">13</span>,<span class="dv">16</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="dv">22</span>,<span class="dv">23</span>,<span class="dv">24</span>,<span class="dv">25</span>,<span class="dv">26</span>)]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(horses.clean,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id       horse_name horse_country is_active country age
1     L247     REAL SUPREME            HK      TRUE     AUS   9
2    44170 LIM'S INVINCIBLE            SG      TRUE     AUS   3
              trainer_id   colour     sex                owner_name import_type
1                    CCW Chestnut Gelding Lai Ni Jan | Benvinda Lai         ISG
2 STEVEN HAROLD BURRIDGE                               LIM'S STABLE            
  current_rating start_of_season_rating total_stake no_of_1_2_3
1             34                     39     6607700    8-5-6-75
2             50                     NA       38182            </code></pre>
</div>
</div>
<p>We are only interested in horses that run in Hong Kong while there are some horses in this data set that raced in Singapore.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="ot">&lt;-</span>horses.clean<span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(horse_country <span class="sc">==</span> <span class="st">"HK"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to clean “no_of_1_2_3”. This column represents how many 1st, 2nd, and 3rd place finishes the horse has ever had. The last number is the total number of races the horse has participated in. We are going to break up this column into seperate columns for placing finishes and number of races.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>split1 <span class="ot">&lt;-</span><span class="fu">str_split_fixed</span>(horses.clean<span class="sc">$</span>no_of_1_2_3, <span class="st">"-"</span>, <span class="dv">4</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="sc">$</span>first_place <span class="ot">&lt;-</span> split1[,<span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="sc">$</span>second_place <span class="ot">&lt;-</span> split1[,<span class="dv">2</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="sc">$</span>third_place <span class="ot">&lt;-</span> split1[,<span class="dv">3</span>]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>horses.clean<span class="sc">$</span>races <span class="ot">&lt;-</span> split1[,<span class="dv">4</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove original column</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>horses.clean <span class="ot">&lt;-</span> horses.clean[,<span class="sc">-</span><span class="dv">15</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(horses.clean,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id     horse_name horse_country is_active country age trainer_id
1     L247   REAL SUPREME            HK      TRUE     AUS   9        CCW
2     T422 AMAZING MOMENT            HK      TRUE     AUS   6        OSP
    colour     sex                owner_name import_type current_rating
1 Chestnut Gelding Lai Ni Jan | Benvinda Lai         ISG             34
2      Bay Gelding   Treinta Pares Syndicate          PP             60
  start_of_season_rating total_stake first_place second_place third_place races
1                     39     6607700           8            5           6    75
2                     57     1337225           1            1           4    19</code></pre>
</div>
</div>
</section>
<section id="now-lets-clean-performances" class="level2">
<h2 class="anchored" data-anchor-id="now-lets-clean-performances">Now let’s clean Performances</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(performances,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id horse_name horse_name_zh horse_no race_id race_no  race_date
1    34204  LORD GREG     LORD GREG       NA      NA       0 2007-06-09
2    34204  LORD GREG     LORD GREG       NA      NA       0 2007-07-01
  race_country final_placing    season going rating jockey_id jockey_name
1           SG             3 2006/2007     G     37  O CHAVEZ    O CHAVEZ
2           SG             2 2006/2007     G     37 B VORSTER   B VORSTER
  jockey_name_zh
1         查维斯
2         沃斯特
                                                                                    jockey_url
1  http://www.turfclub.com.sg/Industry/Jockeys/Pages/JockeyDirectoryDetails.aspx?Name=O+CHAVEZ
2 http://www.turfclub.com.sg/Industry/Jockeys/Pages/JockeyDirectoryDetails.aspx?Name=B+VORSTER
  trainer_id trainer_name trainer_name_zh
1   O CHAVEZ      L LAXON            纳逊
2  B VORSTER      L LAXON            纳逊
                                                                                          trainer_url
1 http://www.turfclub.com.sg/Industry/Trainers/Pages/TrainerDirectoryDetails.aspx?TrainerName=L+LAXON
2 http://www.turfclub.com.sg/Industry/Trainers/Pages/TrainerDirectoryDetails.aspx?TrainerName=L+LAXON
  winning_odds actual_weight running_positions finish_time on_date_weight gears
1          2.6          53.5             7 7 3     1:24:50            497     B
2          2.4          54.0             4 3 2 0.076736111            500     B
  draw length_behind_winner race_class distance course race_location race_url
1    6                 6.8L          5     1400                    S         
2    2                 3.8L          5     1800                    S         
  track sections sections_time last_updated
1  Turf                             00:41.5
2  Turf                             00:41.5</code></pre>
</div>
</div>
<p>We are going to remove the column containing the Cantonese name for the horse, jockey name in Cantonese, jockey url, trainer name in Cantonese, trainer url, race url, running positions (redundant information),and last updated, and length behind winner. Length behind winner being deleted is okay because we have LBW for all 4 sections in another variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="ot">&lt;-</span>performances[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="dv">23</span>,<span class="dv">28</span>,<span class="dv">33</span>,<span class="dv">37</span>)]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perf.clean,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id horse_name horse_no race_id race_no  race_date race_country
1    34204  LORD GREG       NA      NA       0 2007-06-09           SG
2    34204  LORD GREG       NA      NA       0 2007-07-01           SG
  final_placing    season going rating jockey_id jockey_name trainer_id
1             3 2006/2007     G     37  O CHAVEZ    O CHAVEZ   O CHAVEZ
2             2 2006/2007     G     37 B VORSTER   B VORSTER  B VORSTER
  trainer_name winning_odds actual_weight finish_time on_date_weight gears draw
1      L LAXON          2.6          53.5     1:24:50            497     B    6
2      L LAXON          2.4          54.0 0.076736111            500     B    2
  race_class distance course race_location track sections sections_time
1          5     1400                    S  Turf                       
2          5     1800                    S  Turf                       </code></pre>
</div>
</div>
<p>We are going to once again filter out any race in the dataset that happened in Singapore.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="ot">&lt;-</span>perf.clean<span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(race_country <span class="sc">==</span> <span class="st">"HK"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s get rid of race_country column now that all of the values should equal “HK”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="ot">&lt;-</span>perf.clean<span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>race_country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I am going to do one of the important parts of data cleaning for this analyis: Breaking the section data into 4 distinct columns, both for LBW and time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting rid of brackets and commas in the columns</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>sections <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(perf.clean<span class="sc">$</span>sections,<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">,|</span><span class="sc">\\</span><span class="st">{"</span>,<span class="st">""</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>sections <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(perf.clean<span class="sc">$</span>sections,<span class="st">"</span><span class="sc">\\</span><span class="st">}"</span>,<span class="st">","</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>sections_time <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(perf.clean<span class="sc">$</span>sections_time,<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">,|</span><span class="sc">\\</span><span class="st">{"</span>,<span class="st">""</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>sections_time <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(perf.clean<span class="sc">$</span>sections_time,<span class="st">"</span><span class="sc">\\</span><span class="st">}"</span>,<span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># splitting each section into their own column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>split2 <span class="ot">&lt;-</span><span class="fu">str_split_fixed</span>(perf.clean<span class="sc">$</span>sections,<span class="st">","</span>,<span class="dv">6</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section1<span class="ot">&lt;-</span>split2[,<span class="dv">1</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section2<span class="ot">&lt;-</span>split2[,<span class="dv">2</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section3<span class="ot">&lt;-</span>split2[,<span class="dv">3</span>]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section4<span class="ot">&lt;-</span>split2[,<span class="dv">4</span>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section5<span class="ot">&lt;-</span>split2[,<span class="dv">5</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section6<span class="ot">&lt;-</span>split2[,<span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same thing for section time</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>split3 <span class="ot">&lt;-</span><span class="fu">str_split_fixed</span>(perf.clean<span class="sc">$</span>sections_time,<span class="st">","</span>,<span class="dv">6</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section1_time<span class="ot">&lt;-</span>split3[,<span class="dv">1</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section2_time<span class="ot">&lt;-</span>split3[,<span class="dv">2</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section3_time<span class="ot">&lt;-</span>split3[,<span class="dv">3</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section4_time<span class="ot">&lt;-</span>split3[,<span class="dv">4</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section5_time<span class="ot">&lt;-</span>split3[,<span class="dv">5</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section6_time<span class="ot">&lt;-</span>split3[,<span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Getting rid of our original section and section_time columns for redundancy reasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="ot">&lt;-</span><span class="fu">select</span>(perf.clean,<span class="sc">-</span><span class="fu">c</span>(sections,sections_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Removing characters from section time column and converting to numeric</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgsub)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section1_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section1_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section2_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section2_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section3_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section3_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section4_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section4_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section5_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section5_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section6_time <span class="ot">&lt;-</span> <span class="fu">mgsub</span>(perf.clean<span class="sc">$</span>section6_time,<span class="fu">c</span>(<span class="st">'time'</span>,<span class="st">'"'</span>,<span class="st">':'</span>,<span class="st">','</span>),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>,<span class="st">''</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Saving the section time columns as numeric, along with our finishing time column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section1_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section1_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section2_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section2_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section3_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section3_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section4_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section4_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section5_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section5_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>section6_time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(perf.clean<span class="sc">$</span>section6_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>finish_time <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(perf.clean[,<span class="fu">c</span>(<span class="st">"section1_time"</span>,<span class="st">"section2_time"</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"section3_time"</span>,<span class="st">"section4_time"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"section5_time"</span>,<span class="st">"section6_time"</span>)],<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perf.clean,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  horse_id horse_name horse_no race_id race_no  race_date final_placing
1     A001 BURST AWAY        6     250       1 2016-12-11            11
2     A001 BURST AWAY        6     313       6 2017-01-04            11
     season going rating jockey_id jockey_name trainer_id trainer_name
1 2016/2017     G     72        MG     G Mosse        MKL      K L Man
2 2016/2017     G     72       YML   M L Yeung        MKL      K L Man
  winning_odds actual_weight finish_time on_date_weight gears draw race_class
1           49           125       70.04           1083         13          3
2           30           124       71.86           1073          6          3
  distance course race_location track                    section1
1     1200      A            ST  Turf "lbw": "5-1/4" "placing": 9
2     1200      A            HV  Turf "lbw": "2-1/4" "placing": 4
                      section2                      section3 section4 section5
1      "lbw": "3" "placing": 7      "lbw": "4" "placing": 11                  
2  "lbw": "1-1/2" "placing": 3  "lbw": "6-1/2" "placing": 11                  
  section6 section1_time section2_time section3_time section4_time
1                  24.21         22.03         23.80            NA
2                  23.73         23.61         24.52            NA
  section5_time section6_time
1            NA            NA
2            NA            NA</code></pre>
</div>
</div>
<p>Now I want to create a variable that is a measure of a horse’s past performance. A past performance metric could be created to be a very complex variable that weights a multitude of features such as increases in rating over time, historical placement, finishing time history, etc.. I am going to simply create a variable that is the average placement of the horse up until the race date. I could do average race finishing time, but due to every horse running at different distances, I would have to create a an average finishing time for a horse for each distance up until the race date. This method could get computationally ineffcient and also really clutter our data with high dimensionality. For this reason, I am just going to do average placement up until the race date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert race_date to a Date object</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>race_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(perf.clean<span class="sc">$</span>race_date)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the data by horse_id and race_date</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>perf.clean <span class="ot">&lt;-</span> perf.clean <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(horse_id, race_date)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>perf.clean <span class="ot">&lt;-</span> perf.clean <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(horse_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">average_placement =</span> <span class="fu">lag</span>(<span class="fu">cummean</span>(final_placing))) <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># For the first race of each horse, set average_placement to NA</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>perf.clean<span class="sc">$</span>average_placement[<span class="sc">!</span><span class="fu">duplicated</span>(perf.clean<span class="sc">$</span>horse_id)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated data frame</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perf.clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 38
  horse_id horse_name horse_no race_id race_no race_date  final_placing season  
  &lt;chr&gt;    &lt;chr&gt;         &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;date&gt;             &lt;int&gt; &lt;chr&gt;   
1 A001     BURST AWAY        6     250       1 2016-12-11            11 2016/20…
2 A001     BURST AWAY        6     313       6 2017-01-04            11 2016/20…
3 A001     BURST AWAY        8     380      10 2017-01-30             6 2016/20…
4 A001     BURST AWAY        7      87       5 2017-10-05             9 2017/20…
5 A001     BURST AWAY        8     271       8 2017-12-13            11 2017/20…
6 A001     BURST AWAY       14     607       5 2018-04-29             9 2017/20…
# ℹ 30 more variables: going &lt;chr&gt;, rating &lt;int&gt;, jockey_id &lt;chr&gt;,
#   jockey_name &lt;chr&gt;, trainer_id &lt;chr&gt;, trainer_name &lt;chr&gt;,
#   winning_odds &lt;dbl&gt;, actual_weight &lt;dbl&gt;, finish_time &lt;dbl&gt;,
#   on_date_weight &lt;int&gt;, gears &lt;chr&gt;, draw &lt;int&gt;, race_class &lt;chr&gt;,
#   distance &lt;int&gt;, course &lt;chr&gt;, race_location &lt;chr&gt;, track &lt;chr&gt;,
#   section1 &lt;chr&gt;, section2 &lt;chr&gt;, section3 &lt;chr&gt;, section4 &lt;chr&gt;,
#   section5 &lt;chr&gt;, section6 &lt;chr&gt;, section1_time &lt;dbl&gt;, section2_time &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Now I also want to create a variable that indicates how much rest a horse was able to get between races.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>perf.clean <span class="ot">&lt;-</span> perf.clean <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(horse_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_between =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(race_date)))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perf.clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 39
# Groups:   horse_id [1]
  horse_id horse_name horse_no race_id race_no race_date  final_placing season  
  &lt;chr&gt;    &lt;chr&gt;         &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;date&gt;             &lt;int&gt; &lt;chr&gt;   
1 A001     BURST AWAY        6     250       1 2016-12-11            11 2016/20…
2 A001     BURST AWAY        6     313       6 2017-01-04            11 2016/20…
3 A001     BURST AWAY        8     380      10 2017-01-30             6 2016/20…
4 A001     BURST AWAY        7      87       5 2017-10-05             9 2017/20…
5 A001     BURST AWAY        8     271       8 2017-12-13            11 2017/20…
6 A001     BURST AWAY       14     607       5 2018-04-29             9 2017/20…
# ℹ 31 more variables: going &lt;chr&gt;, rating &lt;int&gt;, jockey_id &lt;chr&gt;,
#   jockey_name &lt;chr&gt;, trainer_id &lt;chr&gt;, trainer_name &lt;chr&gt;,
#   winning_odds &lt;dbl&gt;, actual_weight &lt;dbl&gt;, finish_time &lt;dbl&gt;,
#   on_date_weight &lt;int&gt;, gears &lt;chr&gt;, draw &lt;int&gt;, race_class &lt;chr&gt;,
#   distance &lt;int&gt;, course &lt;chr&gt;, race_location &lt;chr&gt;, track &lt;chr&gt;,
#   section1 &lt;chr&gt;, section2 &lt;chr&gt;, section3 &lt;chr&gt;, section4 &lt;chr&gt;,
#   section5 &lt;chr&gt;, section6 &lt;chr&gt;, section1_time &lt;dbl&gt;, section2_time &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Export cleaned data to csv</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(horses.clean,<span class="st">"../../../data/01-modified-data/horses.clean.csv"</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(perf.clean,<span class="st">"../../../data/01-modified-data/perf.clean.csv"</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>