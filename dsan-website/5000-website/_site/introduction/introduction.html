<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN-5000: Project - Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../introduction/introduction.html" rel="" target="" aria-current="page">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-mattycars" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-mattycars/tree/main/data" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gathering/gathering.html" rel="" target="">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-cleaning" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Data Cleaning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-cleaning">    
        <li>
    <a class="dropdown-item" href="../cleaning/cleaning.html" rel="" target="">
 <span class="dropdown-text">Data Cleaning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cleaning/text.html" rel="" target="">
 <span class="dropdown-text">Text Data Cleaning</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../eda/eda.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-naive-bayes-classification" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Naive Bayes Classification</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-naive-bayes-classification">    
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NaiveBayesIntro.html" rel="" target="">
 <span class="dropdown-text">Introduction to Naive Bayes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NB_categorical_classifier.html" rel="" target="">
 <span class="dropdown-text">Classification of Podium Finishing at HKJC using Multinomial Naive Bayes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../NaiveBayes/NB_text_classifier.html" rel="" target="">
 <span class="dropdown-text">Text Classification for Tweet Sentiment Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../dimensionality/dimensionality.html" rel="" target="">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../clustering/clustering.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../trees/classification.html" rel="" target="">
 <span class="menu-text">Classifying Podium Finishers with Decision Trees</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">Classifying Podium Finishers with Decision Trees</span></li>
  <li class="nav-item">
    <a class="nav-link" href="../conclusions/conclusions.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analyzing-what-creates-horse-racing-winners-at-the-hong-kong-jockey-club-hkjc" id="toc-analyzing-what-creates-horse-racing-winners-at-the-hong-kong-jockey-club-hkjc" class="nav-link active" data-scroll-target="#analyzing-what-creates-horse-racing-winners-at-the-hong-kong-jockey-club-hkjc">Analyzing What Creates Horse Racing Winners at the Hong Kong Jockey Club (HKJC)</a>
  <ul class="collapse">
  <li><a href="#a-brief-history" id="toc-a-brief-history" class="nav-link" data-scroll-target="#a-brief-history">A Brief History</a></li>
  <li><a href="#the-pari-mutuel-betting-market" id="toc-the-pari-mutuel-betting-market" class="nav-link" data-scroll-target="#the-pari-mutuel-betting-market">The Pari-Mutuel Betting Market</a></li>
  <li><a href="#project-rationale" id="toc-project-rationale" class="nav-link" data-scroll-target="#project-rationale">Project Rationale</a></li>
  <li><a href="#project-outline-and-direction" id="toc-project-outline-and-direction" class="nav-link" data-scroll-target="#project-outline-and-direction">Project Outline and Direction</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="analyzing-what-creates-horse-racing-winners-at-the-hong-kong-jockey-club-hkjc" class="level1">
<h1>Analyzing What Creates Horse Racing Winners at the Hong Kong Jockey Club (HKJC)</h1>
<p>In this project, I will be exploring the factors that influence the performance of horses at the Hong Kong Jockey Club’s Happy Valley and Sha Tin racing tracks.</p>
<section id="a-brief-history" class="level2">
<h2 class="anchored" data-anchor-id="a-brief-history">A Brief History</h2>
<p>Horse racing has long been a tradition in Hong Kong. Hong Kong is one of China’s two special adminstrative regions, along with Macao, that existed as a British Colony from 1841 until its handover to China on July 1, 1997. Macao, Hong Kong’s Portuguese-founded sister state (transfered to China in 1999 <span class="citation" data-cites="5m3avjafnzx">(<a href="#ref-5m3avjafnzx" role="doc-biblioref">Nations 1999</a>)</span>), is often remarked as the “gambling capital of world” (grossing nearly $5.3 billion USD in gaming/gambling revenue in 2022 <span class="citation" data-cites="5m3avjafnzxc">(<a href="#ref-5m3avjafnzxc" role="doc-biblioref">Statista 2022</a>)</span>), but many people overlook Hong Kong’s gaming history and culture. In the 1840s, Great Britain introduced horse racing to the people of Hong Kong, quickly becoming a staple of entertainment, sporting, and high-class social status within the colony.</p>
<p>In 1884, the Hong Kong Jockey Club (HKJC) was founded as an amatuer body to promote horse racing within Hong Kong. After existing for almost a century, HKJC evolved into a professional institution in 1971 <span class="citation" data-cites="5m3avjafnz">(<a href="#ref-5m3avjafnz" role="doc-biblioref">Cheung 2019</a>)</span>. Even with the handover of the region to China in 1997, HKJC still stands as the only government-granted monopoly for horse racing in Hong Kong. While the handover of the region did cause a brief decline in racing and gaming activity due to poor economic conditions, horse racing in the 21st century has soared at the HJKC. In the 2022-2023 racing season alone, the club achieved a record turnover of HK$305.6 billion ($39.1 billion USD) <span class="citation" data-cites="5m3avjafnzh">(<a href="#ref-5m3avjafnzh" role="doc-biblioref">HKJC 2022</a>)</span> also donated a record HK$7.3 billion ($930 million) to charity, cementing itself as a top ten charitable foundation in the world. HKJC’s commitment to their community and charitable action make it one of the most uniquely spirited gaming institutions in the entire world.</p>
</section>
<section id="the-pari-mutuel-betting-market" class="level2">
<h2 class="anchored" data-anchor-id="the-pari-mutuel-betting-market">The Pari-Mutuel Betting Market</h2>
<p>HKJC’s horse racing betting market is one that is largely foreign to the legalized sports gaming sphere that was newly introduced to the United States in 2021. With US sportsbooks, like Draftkings, FanDuel, BetMGM, etc., users place their bets on sporting events through the sportsbooks’ betting platforms (website or mobile app) according to odds (also known as “lines”) set by the sportsbooks. These lines are determined (fixed) by the sportbook, and if the user’s bet wins, they are paid according to the odds fixed by the sportsbook. On the contrary, if the user loses, the money wagered by the user entirely goes to the sportsbook. While this is one of the most common way sportsbooks and casinos operate around the world, many horse racing promoters and gaming companies, including HJKC, utilize what is called <strong>Pari-Mutuel Betting</strong>.</p>
<p>Pari-mutuel betting, unlike fixed odds wagering, is a system where users, instead of betting against the bookmakers, are essentially betting against other bettors. Discussed in the widely renowned 1988 paper titled “Anomalies: Parimutel Betting Markets: Racetracks and Lotteries”, written by world-leading experts in behavioral economics and finance, Richard Thaler and William T. Ziemba <span class="citation" data-cites="thaler1988anomalies">(<a href="#ref-thaler1988anomalies" role="doc-biblioref">Thaler and Ziemba 1988</a>)</span>, pari-mutuel systems are betting systems in which all bets are placed into a pool and then dividends are awared based on the number of bets taken and the total amount wagered, in the case of horse racing, total number of bets and total amount wagered on a horse to win. The bookmaker, HKJC in our case, takes a portion, a “takeout”, from the pool and then pays out winning users proportionally to the amount of bets/total amount wagered on the winning outcome compared to the rest of the field. For this reason, pari-mutel betting is often called “pool betting”.</p>
<p><strong>Pari-mutuel payoffs are determined by three factors</strong> <span class="citation" data-cites="5m3avjafnzcover">(<a href="#ref-5m3avjafnzcover" role="doc-biblioref">Criscola 2023</a>)</span>:</p>
<ol type="1">
<li>The amount of money placed on the winning horse or combination of horses</li>
<li>The track takeout</li>
<li>Breakage</li>
</ol>
<p>Typically you will see horse racing bookmakers take between a 16% and 20% takeout from the pool (a number established internally by the bookmakers). Breakage, describes the process in which payoffs are rounded down to the nearest dime, a practice that is common in most jurisdictions where horse racing is legal. Looking at a theoretical example of how payouts/odds, takeouts, and breakage work, if 40% of the win pool is wagered on one horse, the wagering public would effectively be saying that the horse in question is a 3:2 proposition. But factor in the track takeout, and that potential payoff would drop to 4:3 (which would display as 1:1, or even money, on your screen). Then breakage could take away up to nine cents per every $2 wagered.</p>
<p>You can probably see how pari-mutuel pricing and odds can get pretty complex, pretty quick, especially when one is betting on mulitple horse placements, either in a specific finishing order or in any finishing order. While this topic is certainly intersting, especially with respects to game theory, it is not neccesarily the focus of this project. While the outcomes of this project may lead to exploration in advanced betting systems in a pari-mutuel horse racing market, it is not going to be of major focus throughout the exploration of this project. This section is intended to lay the groundwork for the rationale behind this project and the reasonings behind why this project is specifically concerning itself with horse racing in Hong Kong.</p>
</section>
<section id="project-rationale" class="level2">
<h2 class="anchored" data-anchor-id="project-rationale">Project Rationale</h2>
<p>As you can see, the pari-mutuel system in which HKJC operates is unique. With HKJC taking a portion of the betting pool for every race, they are guranteed a profit for each race they host, no matter the outcome. This system is different from fixed-odds bookmakers who face the risk of losing money on any given matchup (these bookmakers do intentionally overinflate their odds, adding a “vigorish” to the lines, in order to maximize the attainability of profit, but again, that is out of the scope of this project). Because of this unique characteristic, Hong Kong horse racing can be a widely profitable sport to bet on. This fact is true for two main reasons:</p>
<ol type="1">
<li>Increased market ineffciencies due to the biases of the “uninfomred” betting public</li>
<li>The robust existence of publicly-available past performance data</li>
</ol>
<p>The first point points to the fact that because the odds for each race are essentially being set by the betting public, there leaves room in each of the odds for payouts that are innacurate to the true probability of specific race events/outcomes to occur. In a 2008 paper (originally published in 1994) titled “Computer Based Horse Race Handicapping and Wagering Systems: A Report” written by Bill Benter <span class="citation" data-cites="benter2008computer">(<a href="#ref-benter2008computer" role="doc-biblioref">Benter 2008</a>)</span> (who is widely considered the most succesful sports handicapper of all time), the author points to the fact that while the public on the whole tends to come pretty close to the true probabilites associated with outcomes in horse racing with their probability estimates (the dispersion of wagers in the betting pool), they do have a slight margin of error that creates slight market ineffciencies. These market ineffciences can be found and exploited with the creation of a computerized handicapping model that seeks to predict horse racing outcomes. It is for this core reason that this project is being pursued. With an exploration of the foundational analytical insights that are attached to horse racing, which will be achieved through this project, an accurate advanced handicapping model becomes one step closer to being realized.</p>
<p>The second point highlights the fact that HKJC provides data on every race it has ever hosted on both of its tracks, Happy Valley and Sha Tin (since they started tracking race statistics through computerization). HKJC’s reasoning for providing such data is simply due to the fact that it encourages more people to bet, which in turn allows them to have more of a takeout per pool. American sportsbooks directly profit off their users knowing as little as possible about the events they are betting on, while the contrary is true for HKJC and their horse racing events. Resultantly, HKJC sits on a uniquely rich mountain of data that anyone can use. With publicly-available access to a robust set of data with hundreds of features, it becomes immensely easier and more accesible to not only making an advanced betting model, but also for conducting any analytics in general surrounding horse racing. This fact is another reason why I am choosing to look at Hong Kong horse racing over horse racing anywhere else in the world.</p>
<p>On top of these points, there is not a lot of existing publicly-available literature surrounding horse racing in Hong Kong. The literature that does exist is either outdated, or is a largley unprofessional post on blog sites or Git Hub. The lack of literature shows that there is a large gap in research surrounding horse racing in pari-mutuel systems in general, providing further validity to this project.</p>
<p>Again, while this project will not directly develop an advanced betting system, it is intended that will it serve as some of the early foundation for such a system. Through findings gleaned from this project, more advanced machine learning technqiues and predictive mathematics may be explored. This project will help open a window of opportunity for a more advanced and focused exploration of horse racing and game theory.</p>
</section>
<section id="project-outline-and-direction" class="level2">
<h2 class="anchored" data-anchor-id="project-outline-and-direction">Project Outline and Direction</h2>
<p><strong>With all the above background information, this project intends to explore the following 10 questions:</strong></p>
<ol type="1">
<li>What factors are most important in determining if a horse wins a race?</li>
<li>Does a difference in declared weight of a horse versus its actual weight play at all into if the horse wins?</li>
<li>Does draw (which gate the horse starts out of) impact a horses’s finishing position. If so, to what extent?</li>
<li>Do some horses perform better on turf or grass tracks?</li>
<li>Do certain breeds of horses perform better than others?</li>
<li>Do past race placments give any insight to future placments?</li>
<li>Does a horse’s rest between races have an impact on their racing performance?</li>
<li>Are certain horses sexes preffered over others?</li>
<li>Can we predict if a horse will finish on the podium (top 3 finish)?</li>
</ol>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-benter2008computer" class="csl-entry" role="listitem">
Benter, William. 2008. <span>“Computer Based Horse Race Handicapping and Wagering Systems: A Report.”</span> In <em>Efficiency of Racetrack Betting Markets</em>, 183–98. World Scientific.
</div>
<div id="ref-5m3avjafnz" class="csl-entry" role="listitem">
Cheung, Vincent. 2019. <span>“A Brief History of Hong Kong Horse Racing.”</span> Webpage. <a href="https://www.cathaypacific.com/cx/en_HK/inspiration/hong-kong/brief-history-hong-kong-horse-racing.html#:~:text=Horse%20racing%20was%20brought%20to,the%20city's%20two%20racecourses%20in">https://www.cathaypacific.com/cx/en_HK/inspiration/hong-kong/brief-history-hong-kong-horse-racing.html#:~:text=Horse%20racing%20was%20brought%20to,the%20city's%20two%20racecourses%20in</a>.
</div>
<div id="ref-5m3avjafnzcover" class="csl-entry" role="listitem">
Criscola, Robert. 2023. <span>“Pari-Mutuel Betting Guide: Learn How to Bet on Horse Racing Like a Pro.”</span> Webpage. <a href="https://www.covers.com/horse-racing/pari-mutuel-betting-guide">https://www.covers.com/horse-racing/pari-mutuel-betting-guide</a>.
</div>
<div id="ref-5m3avjafnzh" class="csl-entry" role="listitem">
HKJC. 2022. <span>“The Hong Kong Jockey Club 2022/23 Annual Report.”</span> Webpage. <a href="https://corporate.hkjc.com/corporate/english/history-and-reports/annual-reports.aspx">https://corporate.hkjc.com/corporate/english/history-and-reports/annual-reports.aspx</a>.
</div>
<div id="ref-5m3avjafnzx" class="csl-entry" role="listitem">
Nations, One World. 1999. Webpage. <a href="https://www.nationsonline.org/oneworld/macau.htm#:~:text=Colonized%20by%20the%20Portuguese%20in,China%20on%2020%20December%201999..">https://www.nationsonline.org/oneworld/macau.htm#:~:text=Colonized%20by%20the%20Portuguese%20in,China%20on%2020%20December%201999..</a>
</div>
<div id="ref-5m3avjafnzxc" class="csl-entry" role="listitem">
Statista. 2022. <span>“Number of Casinos in Macao from 2012 to 2022.”</span> Webpage. <a href="https://www.statista.com/statistics/253763/number-of-casinos-in-macao/#:~:text=Macao%2C%20the%20world's%20casino%20capital,dollars%20from%20gaming%20and%20gambling.">https://www.statista.com/statistics/253763/number-of-casinos-in-macao/#:~:text=Macao%2C%20the%20world's%20casino%20capital,dollars%20from%20gaming%20and%20gambling.</a>
</div>
<div id="ref-thaler1988anomalies" class="csl-entry" role="listitem">
Thaler, Richard H, and William T Ziemba. 1988. <span>“Anomalies: Parimutuel Betting Markets: Racetracks and Lotteries.”</span> <em>Journal of Economic Perspectives</em> 2 (2): 161–74.
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>